using iText.Html2pdf;
using iText.Kernel.Pdf;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using iText.Layout;
using iText.Layout.Element;
using iText.Layout.Properties;
using System.Configuration;
using MySql.Data.MySqlClient;
using System.Data;

namespace hr_cam
{
    public partial class Report_dashboard : System.Web.UI.Page
    {
        readonly string strcon = ConfigurationManager.ConnectionStrings["con"].ConnectionString;
        protected void Page_Load(object sender, EventArgs e)
        {
                string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\bootstrap\logo.png";

                // Membaca gambar dari file lokal menjadi array byte
                byte[] imageBytes = File.ReadAllBytes(imagePath);

                // Mengonversi array byte gambar ke format base64
                string base64String = Convert.ToBase64String(imageBytes);

                // Membuat string untuk src image dengan format base64
                string srcBase64 = $"data:image/jpeg;base64,{base64String}";

                // Menetapkan nilai src dari elemen img di code.aspx
                logonya.Attributes["src"] = srcBase64;
            if (!IsPostBack)
            {
                //Response.Write("camera site:"+Session["camera_site2"].ToString());
                //Response.Write("camera:"+Session["camera"].ToString());
                //Response.Write("from2:"+Session["from2"].ToString());
                //Response.Write("to2:"+Session["to2"].ToString());
                FillEventHistory();
            }
        }

        private void FillEventHistory()
        {
            string camera_site = Session["camera_site2"].ToString();
            string camera = Session["camera"].ToString();
            string from = Session["from2"].ToString();
            string to = null;
            if (Session["to2"] != null)
            {
                to = Session["to2"].ToString();
            }

            DateTime fromDate;
            DateTime toDate;
            int x = 0;

            using (MySqlConnection con = new MySqlConnection(strcon))
            {
                if (con.State == ConnectionState.Closed)
                {
                    con.Open();
                }
                if (camera_site == "none") {
                    if (camera == "none")
                    {
                        if (DateTime.TryParse(from.ToString(), out fromDate) && DateTime.TryParse(to, out toDate))
                        {
                            string per1 = from.ToString();
                            string per2 = to.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE DATE(ce.occurred_at) >=@from AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();
                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);



                                            TableBody.Controls.Add(row);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(from.ToString(), out fromDate))
                        {
                            string per1 = from.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);

                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE DATE(ce.occurred_at) >=@from ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }

                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);

                                            string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                            Label2.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(to, out toDate))
                        {
                            string per2 = to.ToString();
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            if (x.ToString() == "1")
                                            {
                                                DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);
                                                string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                                Label1.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                            }
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        if (DateTime.TryParse(from.ToString(), out fromDate) && DateTime.TryParse(to, out toDate))
                        {
                            string per1 = from.ToString();
                            string per2 = to.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE c.id=@camera AND DATE(ce.occurred_at) >=@from AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();
                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);



                                            TableBody.Controls.Add(row);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(from.ToString(), out fromDate))
                        {
                            string per1 = from.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);

                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE c.id=@camera AND DATE(ce.occurred_at) >=@from ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }

                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);

                                            string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                            Label2.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(to, out toDate))
                        {
                            string per2 = to.ToString();
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE c.id=@camera AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            if (x.ToString() == "1")
                                            {
                                                DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);
                                                string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                                Label1.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                            }
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                    }
                }
                else
                {
                    if (camera == "none")
                    {
                        if (DateTime.TryParse(from.ToString(), out fromDate) && DateTime.TryParse(to, out toDate))
                        {
                            string per1 = from.ToString();
                            string per2 = to.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND DATE(ce.occurred_at) >=@from AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();
                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);



                                            TableBody.Controls.Add(row);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(from.ToString(), out fromDate))
                        {
                            string per1 = from.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);

                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND DATE(ce.occurred_at) >=@from ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }

                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);

                                            string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                            Label2.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(to, out toDate))
                        {
                            string per2 = to.ToString();
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            if (x.ToString() == "1")
                                            {
                                                DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);
                                                string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                                Label1.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                            }
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        if (DateTime.TryParse(from.ToString(), out fromDate) && DateTime.TryParse(to, out toDate))
                        {
                            string per1 = from.ToString();
                            string per2 = to.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND c.id=@camera AND DATE(ce.occurred_at) >=@from AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();
                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);



                                            TableBody.Controls.Add(row);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(from.ToString(), out fromDate))
                        {
                            string per1 = from.ToString();
                            Label1.Text = per1.Substring(8, 2) + "-" + per1.Substring(5, 2) + "-" + per1.Substring(0, 4);

                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND c.id=@camera AND DATE(ce.occurred_at) >=@from ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@from", from);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }

                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);

                                            string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                            Label2.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                        else if (DateTime.TryParse(to, out toDate))
                        {
                            string per2 = to.ToString();
                            Label2.Text = per2.Substring(8, 2) + "-" + per2.Substring(5, 2) + "-" + per2.Substring(0, 4);
                            using (MySqlCommand cmd = new MySqlCommand("SELECT ce.camera_id, ce.type AS event_type,ce.plate_number_string, ce.occurred_at, ce.person_identification_number, ce.image_string, ce.image_file, c.location, p.name as person, p.gender, p.image_string as person_image, p.type as person_type, cs.name AS site, ce.image_file, ce.plate_number_file FROM camera_events as ce JOIN cameras as c ON ce.camera_id = c.name LEFT JOIN persons as p ON ce.person_identification_number = p.identification_number JOIN camera_sites AS cs ON c.camera_site_id=cs.id WHERE cs.id=@camera_site AND c.id=@camera AND DATE(ce.occurred_at) <=@to ORDER BY ce.occurred_at ASC", con))
                            {
                                cmd.Parameters.AddWithValue("@camera_site", camera_site);
                                cmd.Parameters.AddWithValue("@camera", camera);
                                cmd.Parameters.AddWithValue("@to", to);
                                cmd.Prepare();
                                using (MySqlDataReader dr = cmd.ExecuteReader())
                                {
                                    if (dr.HasRows)
                                    {
                                        while (dr.Read())
                                        {
                                            x++;
                                            Response.Write("<script>console.log('isinya " + dr.GetValue(0).ToString() + "')</script>");
                                            string image_file = dr["image_file"].ToString();
                                            string plate_number_file = dr["plate_number_file"].ToString();
                                            string occurred_at = dr["occurred_at"].ToString();
                                            string person = dr["person"].ToString();
                                            string location = dr["location"].ToString();
                                            string event_type = dr["event_type"].ToString();
                                            string plate_number_string = dr["plate_number_string"].ToString();
                                            string site = dr["site"].ToString();
                                            string person_type = dr["person_type"].ToString();
                                            TableRow row = new TableRow();

                                            //TableCell no = new TableCell();
                                            //no.Text = x.ToString();
                                            TableCell no = new TableCell() { Text = x.ToString() };
                                            TableCell imageCell = new TableCell();
                                            TableCell pers = new TableCell();
                                            int cek = event_type.IndexOf("Plate");

                                            if (cek != -1)
                                            {
                                                if (!string.IsNullOrEmpty(plate_number_string))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\plate_number_file\" + plate_number_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = "";
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(image_file))
                                                {
                                                    string imagePath = @"C:\Users\ati\source\repos\hr_cam\hr_cam\image_file\" + image_file;
                                                    byte[] imageBytes = File.ReadAllBytes(imagePath);
                                                    string base64String = Convert.ToBase64String(imageBytes);
                                                    //System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image();
                                                    //img.ImageUrl = "data:image/png;base64," + base64String;
                                                    //img.AlternateText = "icon title";
                                                    //img.Style.Add("width", "150px");
                                                    //imageCell.Controls.Add(img);
                                                    System.Web.UI.WebControls.Image img = new System.Web.UI.WebControls.Image
                                                    {
                                                        ImageUrl = "data:image/png;base64," + base64String,
                                                        AlternateText = "icon title"
                                                    };
                                                    img.Style.Add("width", "150px");
                                                    imageCell.Controls.Add(img);
                                                }
                                                pers.Text = person;
                                            }
                                            //TableCell occurred = new TableCell();
                                            //occurred.Text = occurred_at;
                                            //TableCell loc = new TableCell();
                                            //loc.Text = location;
                                            //TableCell sites = new TableCell();
                                            //sites.Text = site;
                                            TableCell occurred = new TableCell() { Text = occurred_at };
                                            TableCell loc = new TableCell() { Text = location };
                                            TableCell sites = new TableCell() { Text = site };
                                            row.Cells.Add(no);
                                            row.Cells.Add(imageCell);
                                            row.Cells.Add(occurred);
                                            row.Cells.Add(loc);
                                            row.Cells.Add(sites);
                                            row.Cells.Add(pers);

                                            TableBody.Controls.Add(row);
                                            if (x.ToString() == "1")
                                            {
                                                DateTime dateTime = DateTime.ParseExact(occurred_at, "dd/MM/yyyy HH:mm:ss", null);
                                                string formattedDateTime = dateTime.ToString("yyyy-MM-dd HH:mm:ss");
                                                Label1.Text = formattedDateTime.Substring(8, 2) + "-" + formattedDateTime.Substring(5, 2) + "-" + formattedDateTime.Substring(0, 4);
                                            }
                                        }
                                        dr.Close();
                                    }
                                    else
                                    {
                                    }
                                }
                            }
                        }
                    }
                }

            }
        }
    }
}