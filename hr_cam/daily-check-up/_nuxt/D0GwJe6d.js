import{_ as E}from"./IwDavgve.js";import{f as P,C as V,D as I,E as D,q as l,l as H,J as L,K as z,c as d,a as t,b as m,i as r,G as b,w as _,M as A,H as R,o as p,Q as T,R as G,t as S}from"./Di3zuZ4U.js";import{_ as F}from"./BoG3M2bQ.js";import"./CclMCVb1.js";import"./BxtVtW52.js";import"./tEGXdHrr.js";const K={class:"w-full flex flex-col gap-2"},j={class:"flex flex-row gap-2"},q={key:0,class:"overflow-x-auto"},J={class:"w-full text-left"},O={class:"p-2"},Q={class:"p-2"},W={key:1,class:"p-4 text-center"},ne=P({__name:"index",setup(X){const M=D(),U=V(),f=I(),k=M.public.API_BASE_URL,h=l(""),v=l(!1),i=l([]),g=l(0),c=l(null),n=l([]),x=H(()=>i.value?i.value.map(s=>({label:`${s.IdentificationNumber} - ${s.Name}`,id:s.ID})):[]),y=async(s=null)=>{try{if(c.value===null){f.add({title:"Gagal mengambil data",description:"Kredensial tidak ditemukan.",color:"error"});return}const e=await $fetch(`${k}/v2/schedules/contractors`,{params:{search:s},headers:{Authorization:c.value}});if(!e.success)throw A({statusCode:400,statusMessage:e.message});let o=e.data;i.value=o}catch(e){let o="Unknown Error";e instanceof Error&&(o=e.message),console.error(o),i.value=[]}},$=async()=>{if(c.value===null){f.add({title:"Gagal mengambil data",description:"Kredensial tidak ditemukan.",color:"error"});return}const s=n.value.map(e=>e.IdentificationNumber).join(`
`);try{const e=s,o=new Blob([e],{type:"text/csv"}),u=new File([o],"file.csv",{type:"text/csv"}),w=new FormData;w.append("file",u);const a=await $fetch(`${k}/v2/dcu/import-absent`,{method:"POST",body:w,headers:{Authorization:c.value}});if(!a.success)throw A({statusCode:400,statusMessage:a.message});f.add({title:"Sukses",description:a.message,color:"success"}),n.value=[]}catch(e){let o="Unknown Error";e instanceof Error&&(o=e.message),console.error(o)}},B=()=>{const s=i.value.find(e=>e.ID===g.value);if(s===void 0){f.add({title:"Gagal menambah personel",description:"Silahkan pilih personel terlebih dahulu.",color:"error"});return}n.value=[s,...n.value]},N=s=>{n.value.splice(s,1)};return L(async()=>{c.value=await U.basicAuth(),y()}),z(h,s=>{console.log(x),v.value&&y(s)}),(s,e)=>{const o=E,u=R,w=F;return p(),d("div",K,[e[7]||(e[7]=t("h1",null,"Personel yang Absen",-1)),t("div",j,[m(o,{modelValue:r(g),"onUpdate:modelValue":e[0]||(e[0]=a=>b(g)?g.value=a:null),"search-term":r(h),"onUpdate:searchTerm":e[1]||(e[1]=a=>b(h)?h.value=a:null),open:r(v),"onUpdate:open":e[2]||(e[2]=a=>b(v)?v.value=a:null),placeholder:"Pilih personil","search-input":{placeholder:"Cari..."},"value-key":"id",items:r(x),class:"w-80"},null,8,["modelValue","search-term","open","items"]),m(u,{onClick:B},{default:_(()=>e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M10 2.5a.5.5 0 0 1 .5.5v6.5H17a.5.5 0 0 1 0 1h-6.5V17a.5.5 0 0 1-1 0v-6.5H3a.5.5 0 0 1 0-1h6.5V3a.5.5 0 0 1 .5-.5"})],-1)])),_:1,__:[3]})]),e[8]||(e[8]=t("h1",null,"Personel yang Absen",-1)),m(w,{variant:"soft"},{header:_(()=>e[4]||(e[4]=[t("h2",{class:"text-lg font-semibold"},"List",-1)])),default:_(()=>[r(n).length>0?(p(),d("div",q,[t("table",J,[e[6]||(e[6]=t("thead",null,[t("tr",{class:""},[t("th",{class:"p-2"},"Badge Number"),t("th",{class:"p-2"},"Name"),t("th",{class:"p-2"},"Action")])],-1)),t("tbody",null,[(p(!0),d(T,null,G(r(n),(a,C)=>(p(),d("tr",{key:C},[t("td",O,S(a.IdentificationNumber),1),t("td",Q,S(a.Name),1),t("td",null,[m(u,{onClick:Y=>N(C)},{default:_(()=>e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M8.5 4h3a1.5 1.5 0 0 0-3 0m-1 0a2.5 2.5 0 0 1 5 0h5a.5.5 0 0 1 0 1h-1.054l-1.194 10.344A3 3 0 0 1 12.272 18H7.728a3 3 0 0 1-2.98-2.656L3.554 5H2.5a.5.5 0 0 1 0-1zM5.741 15.23A2 2 0 0 0 7.728 17h4.544a2 2 0 0 0 1.987-1.77L15.439 5H4.561zM8.5 7.5A.5.5 0 0 1 9 8v6a.5.5 0 0 1-1 0V8a.5.5 0 0 1 .5-.5M12 8a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"})],-1)])),_:2,__:[5]},1032,["onClick"])])]))),128))])])])):(p(),d("div",W,"Tidak ada personel yang dipilih"))]),_:1}),m(u,{label:"Simpan",class:"w-min",onClick:$})])}}});export{ne as default};
