import{_ as D,a as B}from"./BfukKjjh.js";import{_ as P}from"./D4hqmgle.js";import{f as T,q as n,C as M,D as N,E as z,l as G,J as R,K,c as L,a as c,b as u,t as J,i as l,G as _,w as O,M as k,e as j,o as q,H,I as F}from"./BAx2i1UF.js";import"./BzqgwsGc.js";import"./Bi1rWmBN.js";import"./-8EEwp8_.js";import"./BvybM3Dh.js";import"./BXO7cnFK.js";const Q={class:"px-0.5 py-2"},W={class:"flex flex-col gap-2"},X={class:"flex"},Y={class:"flex gap-1"},ie=T({__name:"create",setup(Z){const m=n(),p=n(""),o=n(0),g=n(new Date().toISOString().split("T")[0]),U=n(["pagi","sore","malam"]),d=n(""),x=z(),C=M(),f=N(),b=x.public.API_BASE_URL,i=n(null),h=n(!1),$=t=>{g.value=t.toString()},w=async(t=null)=>{try{if(i.value===null){f.add({title:"Gagal mengambil data",description:"Kredensial tidak ditemukan.",color:"error"});return}const e=await $fetch(`${b}/v2/schedules/contractors`,{params:{search:t},headers:{Authorization:i.value}});if(!e.success)throw k({statusCode:400,statusMessage:e.message});let s=e.data;o.value&&!s.some(a=>a.ID===o.value)&&(s=[await $fetch(`${b}/v2/schedules/contractors/${o.value}`,{headers:{Authorization:i.value}}),...s]),m.value=s}catch(e){let s="Unknown Error";e instanceof Error&&(s=e.message),console.error(s),m.value=[]}},y=async(t,e,s)=>{try{if(i.value===null){f.add({title:"Gagal menambah data",description:"Kredensial tidak ditemukan.",color:"error"});return}const a=await $fetch(`${b}/v2/schedules`,{method:"POST",body:{person_id:t,scheduled_at:e,shift:s},headers:{Authorization:i.value}});if(!a.success)throw k({statusCode:400,statusMessage:a.message})}catch(a){let v="Unknown Error";a instanceof Error&&(v=a.message),console.error(v)}},E=async()=>{const t=A();if(t!==""){f.add({title:"Gagal validasi input",description:t,color:"error"});return}try{await y(o.value,g.value,d.value),f.add({title:"Sukses",description:"Jadwal personil berhasil ditambahkan.",color:"success"}),F("/rosters/")}catch(e){let s="Unknown Error";e instanceof Error&&(s=e.message),console.error(s)}},A=()=>o.value===0?"Silahkan memilih personil terlebih dahulu.":d.value===""?"Silahkan memilih shift terlebih dahulu.":"",I=G(()=>m.value?m.value.map(t=>({label:`${t.IdentificationNumber} - ${t.Name}`,id:t.ID})):[]);return R(async()=>{i.value=await C.basicAuth(),w()}),K(p,t=>{h.value&&w(t)}),(t,e)=>{const s=B,a=P,v=D,S=H,V=j;return q(),L("div",Q,[e[4]||(e[4]=c("div",{class:"flex justify-between items-center mb-6"},[c("h1",{class:"text-2xl font-bold"},"Buat Shift")],-1)),c("div",W,[c("div",X,[u(s,{size:"sm","onUpdate:modelValue":$})]),c("p",null,J(l(g)),1),u(a,{modelValue:l(o),"onUpdate:modelValue":e[0]||(e[0]=r=>_(o)?o.value=r:null),"search-term":l(p),"onUpdate:searchTerm":e[1]||(e[1]=r=>_(p)?p.value=r:null),open:l(h),"onUpdate:open":e[2]||(e[2]=r=>_(h)?h.value=r:null),placeholder:"Pilih personil","search-input":{placeholder:"Cari..."},"value-key":"id",items:l(I),class:"w-48"},null,8,["modelValue","search-term","open","items"]),u(v,{modelValue:l(d),"onUpdate:modelValue":e[3]||(e[3]=r=>_(d)?d.value=r:null),placeholder:"Pilih shift",items:l(U),class:"w-fit"},null,8,["modelValue","items"]),c("div",Y,[u(V,{to:"/rosters/"},{default:O(()=>[u(S,{class:"cursor-pointer",label:"Cancel",variant:"link"})]),_:1}),u(S,{class:"cursor-pointer",label:"Save",onClick:E})])])])}}});export{ie as default};
