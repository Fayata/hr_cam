import{f as H,C as V,q as c,D as O,E as Q,J as q,K as B,c as w,a as t,b as m,w as f,i as l,L as J,M as k,H as W,o as b,d as E,t as g,G as D,N as X,O as Y,Q as Z,R as ee,S as te,_ as se}from"./Di3zuZ4U.js";import{_ as ae,u as $,w as oe}from"./pO2z3XD-.js";import{_ as le}from"./BoG3M2bQ.js";const ne={class:"px-0.5 py-2"},re={class:"flex justify-between items-center mb-6"},ie={class:"space-x-2"},ce={class:"mb-4 flex flex-col gap-3"},ue={class:"flex flex-col sm:flex-row gap-2 items-end"},de={class:"flex flex-col"},pe={class:"flex flex-col"},me={key:0,class:"overflow-x-auto"},fe={class:"w-full text-left"},_e={class:"p-2"},ve={class:"p-2"},ge={class:"p-2"},he={class:"p-2 space-x-2"},xe={key:1,class:"p-4 text-center"},we={class:"flex flex-wrap justify-between items-center gap-2"},ke={class:"text-sm"},be={class:"flex items-center space-x-2"},ye={class:"flex items-center space-x-1"},Ce=["max"],Ae=H({__name:"index",setup(Ee){const G=V(),u=c(1),y=c(1),C=c([]),r=c({has_next:!1,has_prev:!1,page:1,page_size:7,total_count:0,total_pages:1}),z=c(""),S=c(""),U=c(""),h=c(null),P=Q(),p=O(),A=P.public.API_BASE_URL,d=c(null),_=c(!0),v=c(!0),N=()=>{_.value=!_.value},R=()=>{v.value=!v.value},T=async s=>{if(confirm("Apakah Anda yakin ingin mengembalikan status seperti semula?"))try{if(d.value===null){p.add({title:"Gagal menghapus data",description:"Kredensial tidak ditemukan.",color:"error"});return}const e=await $fetch(`${A}/v2/dcu/${s}/restore`,{method:"POST",headers:{Authorization:d.value}});if(!e.success)throw k({statusCode:400,statusMessage:e.message});p.add({title:e.message,color:"success"}),x(u.value)}catch(e){let o="Unknown Error";e instanceof Error&&(o=e.message),p.add({title:o,color:"error"})}},K=s=>{!s||s<1||s>r.value.total_pages||(u.value=s,x(s))},x=async(s=1,e=7,o=z.value,i=S.value,n=U.value)=>{try{if(d.value===null){p.add({title:"Gagal mengambil data",description:"Kredensial tidak ditemukan.",color:"error"});return}const a=await $fetch(`${A}/v2/dcu/absents-paginated`,{params:{page:s,page_size:e,start_date:o,end_date:i,search:n,include_absent:_.value,include_failed:v.value},headers:{Authorization:d.value}});if(!a.success)throw k({statusCode:400,statusMessage:a.message});C.value=a.data.personels,r.value=a.data.meta,u.value=a.data.meta.page}catch(a){let M="Unknown Error";a instanceof Error&&(M=a.message),console.error(M),C.value=[],r.value={has_next:!1,has_prev:!1,page:1,page_size:7,total_count:0,total_pages:1},u.value=1}},L=async()=>{try{if(d.value===null){p.add({title:"Gagal mengambil data",description:"Kredensial tidak ditemukan.",color:"error"});return}const s=await $fetch(`${A}/v2/dcu/absents`,{params:{include_absent:_.value,include_failed:v.value},headers:{Authorization:d.value}});if(!s.success)throw k({statusCode:400,statusMessage:s.message});const e=s.data.map(n=>({"Badge Number":n.identification_number.slice(4),Personel:n.name,Status:n.extra_status_info===0?"Gagal daily check up":"Tidak ikut daily check up"})),o=$.json_to_sheet(e),i=$.book_new();$.book_append_sheet(i,o),oe(i,"anomalies.xlsx",{compression:!0})}catch(s){let e="Unknown Error";s instanceof Error&&(e=s.message),console.error(e)}},F=te((s=1,e=7,o=z.value,i=S.value,n=U.value)=>{x(s,e,o,i,n)},500),j=()=>{h.value&&h.value.click()},I=async s=>{var i;const e=(i=s.target.files)==null?void 0:i[0];if(!e){p.add({title:"No file selected.",color:"error"});return}const o=new FormData;o.append("file",e);try{if(d.value===null)throw p.add({title:"Gagal mengimpor data",description:"Kredensial tidak ditemukan.",color:"error"}),k({statusCode:401,statusMessage:"Kredensial tidak ditemukan, silahkan login kembali"});const n=await $fetch(`${A}/v2/dcu/import-absent`,{method:"POST",headers:{Authorization:d.value},body:o});if(!n.success)throw k({statusCode:400,statusMessage:n.message});p.add({title:n.message,color:"success"}),h.value=null,u.value=1,x()}catch(n){let a="Unknown Error";n instanceof Error&&(a=n.message),console.error(a),h.value=null}};return q(async()=>{d.value=await G.basicAuth(),x()}),B(u,s=>{F(s)}),B([_,v],()=>{u.value=1,F()}),(s,e)=>{const o=W,i=ae,n=le;return b(),w("div",ne,[t("div",re,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold"},"Gagal & Absen DCU",-1)),t("div",ie,[m(o,{class:"cursor-pointer",color:"secondary",onClick:j},{default:f(()=>e[3]||(e[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M17.5 4a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-1 0v-11a.5.5 0 0 1 .5-.5M2 10a.5.5 0 0 1 .5-.5h10.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 .146.351v.006c0 .127-.05.254-.146.35l-4 4a.5.5 0 0 1-.708-.707l3.147-3.146H2.5A.5.5 0 0 1 2 10"})],-1),E(" Import Data Absen ")])),_:1,__:[3]}),m(o,{class:"cursor-pointer",color:"success",onClick:L},{default:f(()=>e[4]||(e[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M2.5 4a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-1 0v-11a.5.5 0 0 1 .5-.5M5 10a.5.5 0 0 1 .5-.5h10.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.707l3.147-3.147H5.5A.5.5 0 0 1 5 10"})],-1),E(" Export Anomaly ")])),_:1,__:[4]}),t("input",{ref_key:"fileInput",ref:h,type:"file",accept:".csv",style:{display:"none"},onChange:I},null,544)])]),t("div",ce,[t("div",ue,[t("div",de,[m(o,{class:"cursor-pointer",label:"Failed",variant:l(v)?"solid":"soft",onClick:R},null,8,["variant"])]),t("div",pe,[m(o,{class:"cursor-pointer",label:"Absent",variant:l(_)?"solid":"soft",onClick:N},null,8,["variant"])])])]),m(n,{variant:"soft"},J({header:f(()=>[e[6]||(e[6]=t("h2",{class:"text-lg font-semibold"},"List",-1))]),default:f(()=>[l(C).length>0?(b(),w("div",me,[t("table",fe,[e[8]||(e[8]=t("thead",null,[t("tr",{class:""},[t("th",{class:"p-2"},"Badge Number"),t("th",{class:"p-2"},"Name"),t("th",{class:"p-2"},"Keterangan"),t("th",{class:"p-2"},"Actions")])],-1)),t("tbody",null,[(b(!0),w(Z,null,ee(l(C),(a,M)=>(b(),w("tr",{key:a.id},[t("td",_e,g(a.identification_number.slice(4)),1),t("td",ve,g(a.name),1),t("td",ge,g(a.extra_status_info===0?"Gagal daily check up":"Tidak ikut daily check up"),1),t("td",he,[m(o,{class:"cursor-pointer",size:"sm",color:"success",variant:"soft",onClick:Me=>T(a.id)},{default:f(()=>e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M9.854 1.146a.5.5 0 1 0-.708.708L10.293 3H9.5a7.5 7.5 0 1 0 7.5 7.5a.5.5 0 0 0-1 0A6.5 6.5 0 1 1 9.5 4h.793L9.146 5.146a.5.5 0 1 0 .708.708l2-2a.5.5 0 0 0 0-.708zm3.493 5.994a.5.5 0 0 1 .013.707l-3.85 4a.5.5 0 0 1-.72 0l-1.65-1.715a.5.5 0 0 1 .72-.693l1.29 1.34l3.49-3.626a.5.5 0 0 1 .707-.013"})],-1),E(" Restore Status ")])),_:2,__:[7]},1032,["onClick"])])]))),128))])])])):(b(),w("div",xe,"No personels found"))]),_:2},[l(r).total_count>0?{name:"footer",fn:f(()=>[t("div",we,[t("span",ke," Showing "+g((l(r).page-1)*l(r).page_size+1)+" to "+g(Math.min(l(r).page*l(r).page_size,l(r).total_count))+" of "+g(l(r).total_count)+" entries ",1),t("div",be,[m(i,{page:l(u),"onUpdate:page":e[0]||(e[0]=a=>D(u)?u.value=a:null),"show-controls":!1,"show-edges":"","sibling-count":1,"items-per-page":l(r).page_size,total:l(r).total_count,variant:"subtle"},null,8,["page","items-per-page","total"]),t("div",ye,[e[10]||(e[10]=t("label",{for:"jump-page",class:"text-sm"},"Go to:",-1)),X(t("input",{id:"jump-page",type:"number","onUpdate:modelValue":e[1]||(e[1]=a=>D(y)?y.value=a:null),min:1,max:l(r).total_pages,class:"w-16 p-1 border rounded"},null,8,Ce),[[Y,l(y),void 0,{number:!0}]]),m(o,{class:"cursor-pointer",size:"sm",color:"primary",onClick:e[2]||(e[2]=a=>K(l(y)))},{default:f(()=>e[9]||(e[9]=[E("Go")])),_:1,__:[9]})])])])]),key:"0"}:void 0]),1024)])}}}),Ue=se(Ae,[["__scopeId","data-v-7900c23e"]]);export{Ue as default};
